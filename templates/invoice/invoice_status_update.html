{% extends "invoice/base.html" %}
{% load static %}

{% block main_content %}

<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <div class="container-full">

    <!-- Content Header (Page header) -->
		<div class="content-header">
			<div class="d-flex align-items-center">
				<div class="me-auto">
					<h4 class="page-title">Set status</h4>
					<div class="d-inline-block align-items-center">
						<nav>
							<ol class="breadcrumb">
								<li class="breadcrumb-item"><a href="{% url 'invoice' %}"><i class="glyphicon glyphicon-circle-arrow-left"></i></a></li>
								<li class="breadcrumb-item active" aria-current="page">Go back</li>
							</ol>
						</nav>
					</div>
				</div>
				
			</div>
		</div>	  

		<!-- Main content -->
		<section class="content">
			<div class="row">			  
				<div class="col-lg-12 col-12">
					<div class="box">
						<div class="box-header with-border">
						  <h4 class="box-title">Change Invoice Status</h4>
						</div>
						<!-- /.box-header -->
                         {% if form.errors %}
							<div class="badge badge-pill badge-danger">
                                {{error}}
							</div>
						{% endif %}
                        <form method="post" enctype="multipart/form-data" class="form">
                        {% csrf_token %}
                        <div class="box-body">
                        
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                    <label>Invoice Status</label>
                                    {{ form.status }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group" id="comment-box" style="display:none;">
                                        <label>Comment</label>
                                        {{ form.comment }}
                                    </div>
                                    <div class="form-group" id="partial-payment-box" style="display:none;">
                                        <label>Partial Payment Amount</label>
                                        {{ form.partial_payment_amount }}
                                    </div>
                                </div>
                            </div>
                        
                        </div>
                        
                        <div class="box-footer">
                            <a href="{% url 'invoice' %}" class="btn btn-warning me-1">
                            <i class="ti-trash"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                            <i class="ti-save-alt"></i> Change status
                            </button>
                        </div>
                        </form>	  
					</div>
					  <!-- /.box -->			
				</div> 
            </div>
        </section>
    </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function() {
    const statusField = document.getElementById("id_status");
    const commentBox = document.getElementById("comment-box");
    const paymentBox = document.getElementById("partial-payment-box");

    function toggleFields() {
        const val = statusField.value;
        commentBox.style.display = (val === "Incomplete") ? "block" : "none";
        paymentBox.style.display = (val === "Not Fully Paid") ? "block" : "none";
    }

    statusField.addEventListener("change", toggleFields);
    toggleFields(); // run on load
});
</script>
  
{% endblock main_content %}

